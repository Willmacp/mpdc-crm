<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MPDC Stakeholder CRM</title>
  <style>
    :root{
      --accent:#5f809b; /* MPDC blue accent */
      --grey:#6d6e71;   /* MPDC grey */
      --bg:#f7f8fa;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#9aa3af;
      --border:#e5e7eb;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:1200px;margin:32px auto;padding:0 16px}
    header{display:flex;flex-wrap:wrap;gap:8px 12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#7899b2)}
    h1{font-size:22px;margin:0}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#eef2f7;border:1px solid var(--border);color:#334155;font-size:12px}
    .chip.ok{background:#e9f8ef;color:#155e2e;border-color:#b7ebc2}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px}
    .btn{appearance:none;border:1px solid var(--border);background:var(--card);padding:8px 12px;border-radius:10px;cursor:pointer;font-size:14px}
    .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    main{display:flex;flex-direction:column;gap:16px}
    section.card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .card-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .card-head h2{margin:0;font-size:18px}
    .card-body{padding:0}
    .table-wrap{overflow:auto;max-height:420px}
    table{border-collapse:separate;border-spacing:0;width:100%;min-width:900px}
    thead th{position:sticky;top:0;background:#f3f5f8;z-index:1;font-weight:600}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    tr:nth-child(even) td{background:#fafbfc}
    .muted{color:var(--muted)}
    .expand{margin:12px 16px 16px}
    footer{margin:28px 0 40px;color:var(--grey);display:flex;justify-content:space-between;align-items:center;font-size:13px}
    a.top{color:var(--accent);text-decoration:none}
    /* widths (tune as needed) */
    .w-name{max-width:220px}
    .w-org{max-width:220px}
    .w-group{max-width:180px}
    .w-role{max-width:160px}
    .w-email{max-width:220px}
    .w-phone{max-width:140px}
    .w-mpdc{max-width:200px}
    .w-date{max-width:140px}
    .w-subj{max-width:260px}
    .w-notes{max-width:320px}
  </style>
  <!-- Robust CSV parser -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>MPDC Stakeholder CRM</h1>
        <span id="chip" class="chip">Data: loadingâ€¦</span>
      </div>
      <div class="toolbar">
        <button class="btn" id="btnLoadCsv">Load CSV</button>
        <button class="btn" id="btnLoadJson">Load JSON</button>
        <button class="btn" id="btnDlJson">Download JSON</button>
        <button class="btn" id="btnDlCsv">Download CSV</button>
      </div>
      <input type="file" id="fileCsv" accept=".csv,text/csv" hidden />
      <input type="file" id="fileJson" accept=".json,application/json" hidden />
    </header>

    <!-- CONTACTS -->
    <section class="card" id="sec-contacts">
      <div class="card-head">
        <h2>Contacts</h2>
        <button class="btn" id="expContacts">Expand list</button>
      </div>
      <div class="card-body">
        <div class="table-wrap" id="tw-contacts">
          <table>
            <thead>
              <tr>
                <th class="w-name">Name</th>
                <th class="w-org">Organisation</th>
                <th class="w-group">Group</th>
                <th class="w-role">Role</th>
                <th class="w-email">Email</th>
                <th class="w-phone">Phone</th>
                <th class="w-mpdc
